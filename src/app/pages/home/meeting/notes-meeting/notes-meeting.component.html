<mat-card class="h-min-400p">
    <mat-card-header >
      <mat-card-title>
        <h2 [textContent]="title" ></h2>
      </mat-card-title>
      <span fxFlex></span>
      <!--Filtrar-->
      <button mat-icon-button matTooltip="Filtrar" aria-label="Filtrar" [matMenuTriggerFor]="filterMenu">
        <mat-icon color="primary">find_in_page</mat-icon>
      </button>
      <mat-menu #filterMenu="matMenu" xPosition="before" class="menu-form-wrapper">
        <div (click)="$event.stopPropagation()">
          <form class="menu-form" [formGroup]="filterFormGroup">
            <mat-label class="titulo-label">Filtrar</mat-label>

            <mat-label *ngIf="currentNoteType==1">Estado Asignación:</mat-label>
            <mat-form-field fxFill appearance="outline" *ngIf="currentNoteType==1">
              <mat-select formControlName="assigmentStatus">
                <mat-option *ngFor="let status of assigmentStatus" [value]="status.id">
                  {{status.status}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-label *ngIf="currentNoteType==2">Estado Acuerdo:</mat-label>
            <mat-form-field fxFill appearance="outline" *ngIf="currentNoteType==2">
              <mat-select formControlName="agreementStatus">
                <mat-option *ngFor="let status of agreementStatus" [value]="status.id">
                  {{status.status}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-label>Grupos:</mat-label>
            <mat-form-field appearance="outline">
              <mat-select formControlName="group" >
                <mat-option (click)=updateSelectId(group.id) *ngFor="let group of groups" [value]="group.id">
                  {{group.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-label *ngIf="selectNotesId">Responsable:</mat-label>
            <mat-form-field appearance="outline">
              <mat-select formControlName="member">
                <mat-option *ngFor="let member of members" [value]="member.id">
                  {{member.firstName}} {{member.lastName}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-label>Palabra o frase:</mat-label>
            <mat-form-field appearance="outline">
              <input matInput type="text" formControlName="word">
            </mat-form-field>

            <a fxFlexAlign="center" (click)="onClickRemoveFilter()">Ver todos</a>
          </form>
        </div>
      </mat-menu>

      <!--Ordenar-->
      <button mat-icon-button matTooltip="Ordenar" aria-label="Ordenar" [matMenuTriggerFor]="orderingMenu">
        <mat-icon color="primary">filter_list</mat-icon>
      </button>
      <mat-menu #orderingMenu="matMenu" xPosition="before" class="menu-form-wrapper">
        <div (click)="$event.stopPropagation()">
          <form class="menu-form" [formGroup]="sortingFormGroup">
            <mat-label class="titulo-label">Ordenar</mat-label>

            <mat-label>Por:</mat-label>
            <mat-form-field fxFill appearance="outline">
              <mat-select formControlName="by" (selectionChange)="onOptionSortChange()">
                <mat-option *ngFor="let option of sortOptions" [value]="option.id">
                  {{option.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-label>Forma:</mat-label>
            <mat-form-field appearance="outline">
              <mat-select formControlName="shape" (selectionChange)="sort()">
                <mat-option *ngFor="let shape of sortShape" [value]="shape.id">
                  {{shape.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <a fxFlexAlign="center" (click)="onClickRemoveSort()">Reiniciar</a>
          </form>
        </div>
      </mat-menu>

      <!--Crear-->
    <!--  <button mat-icon-button matTooltip="Crear" aria-label="Añadir" (click)="openCreateModal()">
        <mat-icon color="primary">add_circle_outline</mat-icon>
      </button>-->


      <!--Notas-->
      <button mat-icon-button matTooltip="Tipo notas" aria-label="Notas" [matMenuTriggerFor]="notaMenu">
        <mat-icon color="primary">more_vert</mat-icon>
      </button>
      <mat-menu #notaMenu="matMenu">
        <div *ngFor="let note of notes">
          <button mat-menu-item (click)="onNoteTypeChange(note.id)">
            <mat-icon color="primary">{{note.icon}}</mat-icon>
            <span>{{note.name}}</span>
          </button>
          <mat-divider></mat-divider>
        </div>
      </mat-menu>
    </mat-card-header>
    <mat-divider></mat-divider>
    <mat-card-content fxLayout="row" class="header">
        <div fxFlex="25%"  fxLayout="column">
            <span  style="margin-left: 6%;" >Titulo</span>
        </div>
        <div fxFlex="20%" fxLayout="column">
            <span>Descripción</span>
        </div>
        <div fxFlex="20%" fxLayout="column">
            <span>Tipo</span>
        </div>
        <div fxFlex="20%" fxLayout="column">
            <span>Responsable</span>
        </div>
        <div fxFlex="15%" fxLayout="column">
            <span >Fecha compromiso</span>
        </div>
    </mat-card-content>
    <mat-card-content fxLayout="column">
      <table mat-table [dataSource]="dataSource"
             cdkDropList [cdkDropListData]="assignments" (cdkDropListDropped)="drop($event)">
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element" >
            <div fxLayout="column" >
              <span class="title" matTooltip="{{element.title}}">{{element.title}}</span>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="group">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element" >
            <span class="title" matTooltip="{{element.content}}">{{element.content}}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element" >
              <span class="title" matTooltip="{{element.handler}}">{{element.handler}}</span>
            </td>
          </ng-container>

        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <div fxLayout="row wrap" fxLayoutAlign="start center" *ngIf="element.user != null" class="w-100">
              <ngx-avatar  *ngIf="element.user.firstName !=='' " fxHide.lt-md src="{{element.user.img}}"
                           [name]="element.user.firstName + ' ' + element.user.lastName"
                           size="40" class="w-50px">
              </ngx-avatar>
              <ngx-avatar  *ngIf="element.user.firstName ==''" fxHide.lt-md src="{{element.user.img}}"
                           [name]="element.user.email"
                           size="40" class="w-50px">
              </ngx-avatar>
              <br>
              <span class="title w-50" *ngIf="element.user.firstName !==''">{{element.user.firstName}} {{element.user.lastName}}</span>
              <span class="title w-50" *ngIf="element.user.firstName ===''">{{element.user.email}} </span>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <div fxLayout="column" class="w-100">
              <span *ngIf="!element.date" class="title w-80">{{element.finalDate | date:'dd/MM/yyyy'}}</span>
              <span *ngIf="element.date" class="title w-80">{{element.date | date:'dd/MM/yyyy'}}</span>
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <div  *ngIf="element.status!=3" fxLayout="column" fxLayoutAlign="center center" class="w-100">
              <button fxFlex="center" mat-icon-button [matMenuTriggerFor]="statusMenu" #menuTrigger="matMenuTrigger"
                      [ngStyle]="{display: (!isLoadingStatusOptions || (isLoadingStatusOptions && element.id != activeRowId)) ? 'block' : 'none'}"
                      aria-label="Cambio estatus" (click)="onCheckNextStatus(element.id, menuTrigger,element)">
                <mat-icon (click)="getSelectAssig(element)" color="primary">more_horiz</mat-icon>
              </button>
              <mat-spinner [diameter]="20" *ngIf="isLoadingStatusOptions && element.id == activeRowId"></mat-spinner>
              <mat-menu #statusMenu="matMenu" >
                <div *ngFor="let option of statusMenuOptions">
                  <button mat-menu-item class="status-option-btn" >
                    <span (click)="nextStatus(element,option.description)">{{option.description}}</span>
                  </button>
                  <mat-divider></mat-divider>
                </div>
              </mat-menu>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns">
            <td *ngFor="let p of displayedColumns"> {{p}} </td>
        </tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            [ngClass]="{'normal-background-color' : activeRowId != row.id,
             'active-background-color' : activeRowId == row.id}"
            cdkDragLockAxis="y" cdkDrag [cdkDragData]="row">
        </tr>
      </table>
<!--      <mat-paginator (page)=" Resizepage($event)" [ngStyle]="{display: showPaginator ? 'block' : 'none'}" [pageSizeOptions]="[5, 10]"-->
<!--                     [pageSize]="pageSize"  showFirstLastButtons></mat-paginator>-->
      <div fxLayout="column" fxLayoutAlign="center center" class="empty-container"
           *ngIf="dataSource.data.length == 0">
        <img src="assets/images/empty_box.jpg" alt="No hay asignación o acuerdo">
        <span *ngIf="currentNoteType == 1">{{emptyAssignments}}</span>
        <span *ngIf="currentNoteType == 2">{{emptyAgreements}}</span>
      </div>

    </mat-card-content>
  </mat-card>
